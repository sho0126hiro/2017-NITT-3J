/***  mp3ex05.txt  ***/
/***  s16306  3J43  廣瀬 翔  ***/

1．課題
	「led2nd.c」で「#include "h8_3048fone.h"」を消去し，h8_3048fone.h中にある関数initLed()，turnOnLed()，
	turnOffLed()を自分のプログラム中にコピー＆ペーストし，必要ならば記述を追加して動作を確認し，
	提出しなさい。
	#include "ファイル名"とは，#includeが記述された位置に，そのファイルの内容が書かれていると解釈して
	コンパイルしなさいという意味である。
	考察に次のことを記述しなさい。
	「３． マイクロコンピュータのプログラムと，デジタルの0V，5Vの世界をつなぐ」を読み直して
	h8_3048fone.h中にある関数 initLed()，turnOnLed()，turnOffLed()について説明しなさい。
	なおH8/3048foneハードウェアマニュアルの関連する説明を抜き出しなさい。（９．６ ポート5，モード７参照）
	http://tnct20.tokyo-ct.ac.jp/~kosaka/for_students/H8/j602093_h83048.pdf
	
2．使用したプログラム
	#include <3048fone.h>

	void waitmsec(int msec)
	{
		int i,j;
		for (i=0;i<msec;i++) {
			for (j=0;j<4190;j++);    /*4190は実測によって求めた値 25MHz駆動*/
		}
	}

	/* ------------------------------------------------- */
	/* LED INITIALIZATION */
	/* ------------------------------------------------- */
	/**********************************************************
	LED 0:P5-0
	LED 1:P5-1
	LED 2:P5-2
	LED 3:P5-3
	下位4ビットを出力にする
	**********************************************************/
	void initLed()
	{
		P5.DDR = 0xf;
	}

	/* ------------------------------------------------- */
	/* LET LED ON */
	/* ------------------------------------------------- */
	/*numberは0または1*/
	void turnOnLed(short int number)
	{ 
		static const unsigned char mask[]={1,2,4,8};
		P5.DR.BYTE |= mask[number];
	}

	/* ------------------------------------------------- */
	/* LET LED OFF */
	/* ------------------------------------------------- */
	/*numberは0または1*/
	void turnOffLed(short int number)
	{
		static const unsigned char mask[]={0xfe,0xfd,0xfb,0xf7};
		P5.DR.BYTE &= mask[number];
	}
	main()
	{
		initLed();
		while(1) {
			turnOnLed(0); /*LED0のON*/
			turnOffLed(1); /*LED1のOFF*/
			waitmsec(1000);
			turnOffLed(0); /*LED0のOFF*/
			turnOnLed(1); /*LED1のON*/
			waitmsec(1000);
		}
	}

3．実行結果

	LED0点灯
	LED1消灯
	
	1秒経過
	
	LED0消灯
	LED1点灯
	
	1秒経過
	
	LED0点灯
	LED1消灯
	
	1秒経過
	
	LED0消灯
	LED1点灯
	
	1秒経過
	
	以下，上の動作を繰り返す

4．考察
	関数について説明する．
	initLed()
		P5(LED)の下位4ビットに1を与え，初期化している．
		(出力に設定）
		P5.DDR = 0xf;//0xf:1111(2)
		
	turnOnLed()
		mask[]={1,2,4,8};と設定することによって，
		LEDの番号（LED1，LED0）とLEDのビット番号が合うようにしている．
		よって，正常に動作（点灯）する．
		
		例：turnOnLed(1)のときmask[1]が出力になるが，
			mask[1]=2,これは二進数で10より，LED1が点灯する．
		
	turnOffLed()
		mask[]={0xfe,0xfd,0xfb,0xf7};と設定することによって，
		LEDの番号（LED1，LED0）とLEDのビット番号が合うようにしている．
		よって，正常に動作（消灯）する．
		
		例：turnOffLed(1)のときmask[1]が出力になるが，
			mask[1]=0xfd,これは二進数で11111101より，LED1が消灯する．
			
	H8/3048foneハードウェアマニュアル
	9.6 モード 7（シングルチップモード）
		
		ポート 5 は、入出力ポートとして機能します。P5DDR に 1 をセットすると対応する端子は出力ポ
		ートになり、0 にクリアすると入力ポートになります。
		モード 1〜4 のとき、P5DDR はリードすると常に 1 が読み出されます。ライトは無効です。
		モード 5〜7 では P5DDR はライト専用レジスタで、リードは無効です。リードすると 1 が読み出
		されます。
		P5DDR は、リセット、またはハードウェアスタンバイモード時に、モード 1〜4 の場合は H'FF に、
		モード 5〜7 の場合は H'F0 にイニシャライズされます。ソフトウェアスタンバイモード時には直前
		の状態を保持します。そのため、ポート 5 が入出力ポートとして機能しているとき、P5DDR が 1 に
		セットされた状態でソフトウェアスタンバイモードに遷移すると、その端子は出力状態のままとな
		っています。

	
			
5．まとめ
	initLed()，turnOnLed()，turnOffLed()の内容を理解し，
	どのような指示を送っているかなどを学んだ．

